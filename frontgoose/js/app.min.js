function getPosition(t,e,n,o){return(t+e*n-o/2).toString()+"px"}function positionElements(){var t=$("#topBar").height(),e=$(window).height()-t,n=$(window).width(),o=document.getElementById("streamImage");o.style.maxWidth=n.toString()+"px",o.style.maxHeight=e.toString()+"px";var i=e/3,c=n/8,r=e/4,a=n/6,s=document.getElementById("upButton"),d=getPosition(0,n,7/8,c);s.style.left=d,s.style.top=getPosition(t,e,.25,i),s.style.height=i.toString()+"px",s.style.width=c.toString()+"px";var u=document.getElementById("downButton");u.style.left=d,u.style.top=getPosition(t,e,.75,i),u.style.height=i.toString()+"px",u.style.width=c.toString()+"px";var l=document.getElementById("leftButton"),m=getPosition(t,e,.75,r);l.style.left=getPosition(0,n,1/8,a),l.style.top=m,l.style.height=r.toString()+"px",l.style.width=a.toString()+"px";var g=document.getElementById("rightButton");g.style.left=getPosition(0,n,3/8,a),g.style.top=m,g.style.height=r.toString()+"px",g.style.width=a.toString()+"px";var h=document.getElementById("rotateCCWButton"),p=getPosition(t,e,.25,r);h.style.left=getPosition(0,n,1/8,a),h.style.top=p,h.style.height=r.toString()+"px",h.style.width=a.toString()+"px";var f=document.getElementById("rotateCWButton");f.style.left=getPosition(0,n,3/8,a),f.style.top=p,f.style.height=r.toString()+"px",f.style.width=a.toString()+"px"}function createImageLayer(){var t=new Image;t.style.position="absolute";var e=document.getElementById("streamImage");t.width=e.width,t.height=e.height,t.style.zIndex=-1,t.onload=imageOnload,t.src="http://192.168.1.234:8080/?action=snapshot&n="+ ++imageNumber;var n=document.getElementById("stream");n.insertBefore(t,n.firstChild)}function imageOnload(){for(this.style.zIndex=imageNumber;1<finished.length;){var t=finished.shift();t.parentNode.removeChild(t)}finished.push(this),createImageLayer()}$(function(){function t(t,e){switch(t){case 38:case 87:n.forward=e;break;case 40:case 83:n.backward=e;break;case 37:case 65:n.left=e;break;case 39:case 68:n.right=e;break;case 81:n.rotateCW=e;break;case 69:n.rotateCCW=e}n.updateCommand()}var e=new ReconnectingWebSocket("ws://192.168.1.234:9012",null,{debug:!1,reconnectInterval:1e3}),n={forward:!1,backward:!1,left:!1,right:!1,rotateCW:!1,rotateCCW:!1,updateCommand:function(){var t={direction:null,turn:null,speed:1,turnSpeed:.8};this.rotateCW^this.rotateCCW?this.rotateCW?t.direction="rotateCW":t.direction="rotateCCW":this.forward^this.backward&&(this.forward?t.direction="forward":t.direction="backward"),this.left^this.right&&(this.left?t.turn="left":t.turn="right");var n={type:"setMotionState",data:t};e.send(JSON.stringify(n))}};document.onkeydown=function(e){t(e.keyCode,!0)},document.onkeyup=function(e){t(e.keyCode,!1)},$("#upButton").on({touchstart:function(){n.forward=!0,n.updateCommand()},touchend:function(){n.forward=!1,n.updateCommand()}}),$("#downButton").on({touchstart:function(){n.backward=!0,n.updateCommand()},touchend:function(){n.backward=!1,n.updateCommand()}}),$("#leftButton").on({touchstart:function(){n.left=!0,n.updateCommand()},touchend:function(){n.left=!1,n.updateCommand()}}),$("#rightButton").on({touchstart:function(){n.right=!0,n.updateCommand()},touchend:function(){n.right=!1,n.updateCommand()}}),$("#rotateCCWButton").on({touchstart:function(){n.rotateCCW=!0,n.updateCommand()},touchend:function(){n.rotateCCW=!1,n.updateCommand()}}),$("#rotateCWButton").on({touchstart:function(){n.rotateCW=!0,n.updateCommand()},touchend:function(){n.rotateCW=!1,n.updateCommand()}})}),document.body.ontouchmove=function(){event.preventDefault()},$(function(){positionElements()}),$(window).resize(function(){positionElements()}),$(document).foundation({offcanvas:{open_method:"overlap",close_on_click:!0}}),function(t,e){"function"==typeof define&&define.amd?define([],e):"undefined"!=typeof module&&module.exports?module.exports=e():t.ReconnectingWebSocket=e()}(this,function(){function t(e,n,o){function i(t,e){var n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!1,!1,e),n}var c={debug:!1,automaticOpen:!0,reconnectInterval:1e3,maxReconnectInterval:3e4,reconnectDecay:1.5,timeoutInterval:2e3,maxReconnectAttempts:null,binaryType:"blob"};o||(o={});for(var r in c)"undefined"!=typeof o[r]?this[r]=o[r]:this[r]=c[r];this.url=e,this.reconnectAttempts=0,this.readyState=WebSocket.CONNECTING,this.protocol=null;var a,s=this,d=!1,u=!1,l=document.createElement("div");l.addEventListener("open",function(t){s.onopen(t)}),l.addEventListener("close",function(t){s.onclose(t)}),l.addEventListener("connecting",function(t){s.onconnecting(t)}),l.addEventListener("message",function(t){s.onmessage(t)}),l.addEventListener("error",function(t){s.onerror(t)}),this.addEventListener=l.addEventListener.bind(l),this.removeEventListener=l.removeEventListener.bind(l),this.dispatchEvent=l.dispatchEvent.bind(l),this.open=function(e){if(a=new WebSocket(s.url,n||[]),a.binaryType=this.binaryType,e){if(this.maxReconnectAttempts&&this.reconnectAttempts>this.maxReconnectAttempts)return}else l.dispatchEvent(i("connecting")),this.reconnectAttempts=0;(s.debug||t.debugAll)&&console.debug("ReconnectingWebSocket","attempt-connect",s.url);var o=a,c=setTimeout(function(){(s.debug||t.debugAll)&&console.debug("ReconnectingWebSocket","connection-timeout",s.url),u=!0,o.close(),u=!1},s.timeoutInterval);a.onopen=function(n){clearTimeout(c),(s.debug||t.debugAll)&&console.debug("ReconnectingWebSocket","onopen",s.url),s.protocol=a.protocol,s.readyState=WebSocket.OPEN,s.reconnectAttempts=0;var o=i("open");o.isReconnect=e,e=!1,l.dispatchEvent(o)},a.onclose=function(n){if(clearTimeout(c),a=null,d)s.readyState=WebSocket.CLOSED,l.dispatchEvent(i("close"));else{s.readyState=WebSocket.CONNECTING;var o=i("connecting");o.code=n.code,o.reason=n.reason,o.wasClean=n.wasClean,l.dispatchEvent(o),e||u||((s.debug||t.debugAll)&&console.debug("ReconnectingWebSocket","onclose",s.url),l.dispatchEvent(i("close")));var c=s.reconnectInterval*Math.pow(s.reconnectDecay,s.reconnectAttempts);setTimeout(function(){s.reconnectAttempts++,s.open(!0)},c>s.maxReconnectInterval?s.maxReconnectInterval:c)}},a.onmessage=function(e){(s.debug||t.debugAll)&&console.debug("ReconnectingWebSocket","onmessage",s.url,e.data);var n=i("message");n.data=e.data,l.dispatchEvent(n)},a.onerror=function(e){(s.debug||t.debugAll)&&console.debug("ReconnectingWebSocket","onerror",s.url,e),l.dispatchEvent(i("error"))}},1==this.automaticOpen&&this.open(!1),this.send=function(e){if(a)return(s.debug||t.debugAll)&&console.debug("ReconnectingWebSocket","send",s.url,e),a.send(e);throw"INVALID_STATE_ERR : Pausing to reconnect websocket"},this.close=function(t,e){"undefined"==typeof t&&(t=1e3),d=!0,a&&a.close(t,e)},this.refresh=function(){a&&a.close()}}if("WebSocket"in window)return t.prototype.onopen=function(t){},t.prototype.onclose=function(t){},t.prototype.onconnecting=function(t){},t.prototype.onmessage=function(t){},t.prototype.onerror=function(t){},t.debugAll=!1,t.CONNECTING=WebSocket.CONNECTING,t.OPEN=WebSocket.OPEN,t.CLOSING=WebSocket.CLOSING,t.CLOSED=WebSocket.CLOSED,t});var imageNumber=0,finished=new Array;$(function(){createImageLayer()});